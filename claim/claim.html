<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Claim. Manage</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="stylesheet" href="style.css" media="screen" title="no title">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/3.4.1/firebase.js"></script>
    <link rel="stylesheet" href="css/framework7.ios.css">
    <link rel="stylesheet" href="css/framework7.ios.colors.min.css">
  </head>
  <body>
    <div class="nav-bar">
        <h1>claim.</h1>
    </div>
      <div class="wrapper">
        <!--<h2 style='margin-bottom: 3px;'><div class="circle-pend big"></div>#1 Unpaid Overtime <span style="color: grey;font-size:0.83em;" class="">2016-10-08</span></h2>
        <p style='margin: 0; margin-top:3px;'>To Jack Smith <span style="color: grey;">jack.smith@unistruct.com.au</span></p>
        <div><h3><span style="color: #e74c3c;">Reason: </span></h3><p>Haven't been paid for overtime at the Barangaroo building site.</p></div>
        <hr>
        <div><h3><span style="color: #e74c3c;">Price: </span></h3><p>$10000</p></div>
        <hr>
        <div><h3><span style="color: #e74c3c;">Reason for denial: </span></h3><p>Price too high.</p>-->
      </div>

    <div class="footer">
      <p>A Henry Confos Production</p>
    </div>

  <script type="text/javascript" src="js/jquery-1.9.1.min.js"></script>
  <script type="text/javascript" src="js/framework7.min.js"></script>
  <script type="text/javascript" src="js/jquery.autocomplete.min.js"></script>
  <script type="text/javascript" src="js/sha256.js"></script>
  <script type="text/javascript" src="js/hash.js"></script>
  <script type="text/javascript" src="js/index.js"></script>
  <script>
  var config = {
    apiKey: "AIzaSyCVLxOfjJAWnURGzZeQxePbbC1yX_GVZMc",
    authDomain: "claim-1e7a8.firebaseapp.com",
    databaseURL: "https://claim-1e7a8.firebaseio.com",
    storageBucket: "",
    messagingSenderId: "923622627127"
  };
  firebase.initializeApp(config);
  function getparam() {
    var query = location.search.substr(1);
    var result = "";
    query.split("&").forEach(function(part) {
      var item = part.split("=");
      result = decodeURIComponent(item[1]);
    });
    return result;
  }
  if (getparam()) {
    //ids = getparam().split("_");
    var trampolineRef = firebase.database().ref('/trampolines/'+getparam());
    trampolineRef.on('value', function(snapshot) {
    var x = snapshot.val();
    ids = x.split("_");
    var userRef = firebase.database().ref('/'+ids[0]+'/claims/'+ids[1]);
    userRef.on('value', function(snapshot) {
      $('.wrapper').empty();
      var p = snapshot.val();
      try {
        if (hashPin() == p["hash"]) {
          $('.wrapper').append("<h2>Access Denied: Creator doesn't have access to claim link.</h2>")
        } else {
          if (p["status"] == "filler") {
                window.location = "./index.html";
            } else if (p["status"] == "true") {
                $('.wrapper').append("<h2 style='margin-bottom: 3px;'><div class='circle big'></div>#"+ids[1]+" "+p["title"]+" <span style='color: grey;font-size:0.83em;' class=''>"+p["date"]+"</span></h2><p style='margin: 0; margin-top:3px;'>To "+p["name"]+" <span style='color: grey;'>"+p["email"]+"</span></p><div><h3><span style='color: #e74c3c;'>Reason: </span></h3><p>"+p["reason"]+"</p><hr><div><h3><span style='color: #e74c3c;'>Price: </span></h3><p>"+p["price"]+"</p></div><hr>")
            } else if (p["status"] == "false") {
                $('.wrapper').append("<h2 style='margin-bottom: 3px;'><div class='circle-bad big'></div>#"+ids[1]+" "+p["title"]+" <span style='color: grey;font-size:0.83em;' class=''>"+p["date"]+"</span></h2><p style='margin: 0; margin-top:3px;'>To "+p["name"]+" <span style='color: grey;'>"+p["email"]+"</span></p><div><h3><span style='color: #e74c3c;'>Reason: </span></h3><p>"+p["reason"]+"</p></div><hr><div><h3><span style='color: #e74c3c;'>Price: </span></h3><p>"+p["price"]+"</p></div><hr><div><h3><span style='color: #e74c3c;''>Reason for denial: </span></h3><p>"+p["statusReason"]+"</p></div>")
            } else if (p["status"] == "pending") {
                $('.wrapper').append("<h2 style='margin-bottom: 3px;'><div class='circle-pend big'></div>#"+ids[1]+" "+p["title"]+" <span style='color: grey;font-size:0.83em;' class=''>"+p["date"]+"</span></h2><p style='margin: 0; margin-top:3px;'>To "+p["name"]+" <span style='color: grey;'>"+p["email"]+"</span></p><div><h3><span style='color: #e74c3c;'>Reason: </span></h3><p>"+p["reason"]+"</p><hr><div><h3><span style='color: #e74c3c;'>Price: </span></h3><p>"+p["price"]+"</p></div><hr>")
            }
          }
        }
      catch(err) {
        window.location = "./auth.html?r="+getparam();
      }
    });
    });
  }
  </script>
  </body>
</html>
